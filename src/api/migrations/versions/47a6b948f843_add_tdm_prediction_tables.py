"""Add TDM prediction tables

Revision ID: 47a6b948f843
Revises: 8b697cb08897
Create Date: 2026-01-15 11:57:19.445404

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "47a6b948f843"
down_revision = "8b697cb08897"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "tdm_predictions",
        sa.Column("id", sa.Integer(), autoincrement=True, nullable=False),
        sa.Column("creation_date", sa.DateTime(timezone=True), nullable=False),
        sa.Column("time_range_start", sa.DateTime(timezone=True), nullable=False),
        sa.Column("time_range_end", sa.DateTime(timezone=True), nullable=False),
        sa.Column("site_name", sa.Text(), nullable=False),
        sa.Column("norad_id", sa.Integer(), nullable=False),
        sa.Column("reference_frame", sa.Text(), nullable=False),
        sa.Column("date_added", sa.DateTime(timezone=True), nullable=False),
        sa.Column("track_id", sa.Text(), nullable=False),
        sa.Column("folder_name", sa.Text(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_tdm_predictions_norad_id", "tdm_predictions", ["norad_id"], unique=False
    )
    op.create_index(
        "idx_tdm_predictions_site_name", "tdm_predictions", ["site_name"], unique=False
    )
    op.create_table(
        "tdm_prediction_points",
        sa.Column("id", sa.Integer(), autoincrement=True, nullable=False),
        sa.Column("tdm_prediction_id", sa.Integer(), nullable=False),
        sa.Column("timestamp", sa.DateTime(timezone=True), nullable=False),
        sa.Column("right_ascension", sa.Float(), nullable=False),
        sa.Column("declination", sa.Float(), nullable=False),
        sa.Column("apparent_magnitude", sa.Float(), nullable=True),
        sa.ForeignKeyConstraint(
            ["tdm_prediction_id"],
            ["tdm_predictions.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("tdm_prediction_id", "timestamp"),
    )
    op.create_index(
        "idx_tdm_prediction_points_prediction_id",
        "tdm_prediction_points",
        ["tdm_prediction_id"],
        unique=False,
    )
    op.create_index(
        "idx_tdm_prediction_points_ra_dec",
        "tdm_prediction_points",
        ["right_ascension", "declination"],
        unique=False,
    )
    op.create_index(
        "idx_tdm_prediction_points_timestamp",
        "tdm_prediction_points",
        ["timestamp"],
        unique=False,
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        "idx_tdm_prediction_points_timestamp", table_name="tdm_prediction_points"
    )
    op.drop_index(
        "idx_tdm_prediction_points_ra_dec", table_name="tdm_prediction_points"
    )
    op.drop_index(
        "idx_tdm_prediction_points_prediction_id", table_name="tdm_prediction_points"
    )
    op.drop_table("tdm_prediction_points")
    op.drop_index("idx_tdm_predictions_site_name", table_name="tdm_predictions")
    op.drop_index("idx_tdm_predictions_norad_id", table_name="tdm_predictions")
    op.drop_table("tdm_predictions")
    # ### end Alembic commands ###
